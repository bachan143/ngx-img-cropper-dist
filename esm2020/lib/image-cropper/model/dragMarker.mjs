import { Handle } from './handle';
import { PointPool } from './pointPool';
export class DragMarker extends Handle {
    constructor(x, y, radius, cropperSettings) {
        super(x, y, radius, cropperSettings);
        this.iconPoints = [];
        this.scaledIconPoints = [];
        this.getDragIconPoints(this.iconPoints, 1);
        this.getDragIconPoints(this.scaledIconPoints, 1.2);
    }
    draw(ctx) {
        if (this.over || this.drag) {
            this.drawIcon(ctx, this.scaledIconPoints);
        }
        else {
            this.drawIcon(ctx, this.iconPoints);
        }
    }
    getDragIconPoints(arr, scale) {
        const maxLength = 17 * scale;
        const arrowWidth = 14 * scale;
        const arrowLength = 8 * scale;
        const connectorThroat = 4 * scale;
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(-arrowWidth / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(0, maxLength));
        arr.push(new PointPool().instance.borrow(arrowWidth / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, maxLength - arrowLength));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(maxLength, 0));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, -arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(maxLength - arrowLength, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(connectorThroat / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(arrowWidth / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(0, -maxLength));
        arr.push(new PointPool().instance.borrow(-arrowWidth / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, -maxLength + arrowLength));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, -connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, -arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(-maxLength, 0));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, arrowWidth / 2));
        arr.push(new PointPool().instance.borrow(-maxLength + arrowLength, connectorThroat / 2));
        arr.push(new PointPool().instance.borrow(-connectorThroat / 2, connectorThroat / 2));
    }
    drawIcon(ctx, points) {
        if (this.cropperSettings.showCenterMarker) {
            ctx.beginPath();
            ctx.moveTo(points[0].x + this.position.x, points[0].y + this.position.y);
            for (const p of points) {
                ctx.lineTo(p.x + this.position.x, p.y + this.position.y);
            }
            ctx.closePath();
            ctx.fillStyle = this.cropperSettings.cropperDrawSettings.dragIconFillColor;
            ctx.fill();
            ctx.lineWidth = this.cropperSettings.cropperDrawSettings.dragIconStrokeWidth;
            ctx.strokeStyle = this.cropperSettings.cropperDrawSettings.dragIconStrokeColor;
            ctx.stroke();
        }
    }
    recalculatePosition(bounds) {
        const c = bounds.getCentre();
        this.setPosition(c.x, c.y);
        new PointPool().instance.returnPoint(c);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ01hcmtlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1pbWctY3JvcHBlci9zcmMvbGliL2ltYWdlLWNyb3BwZXIvbW9kZWwvZHJhZ01hcmtlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ2xDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFLeEMsTUFBTSxPQUFPLFVBQVcsU0FBUSxNQUFNO0lBSXBDLFlBQ0UsQ0FBUyxFQUNULENBQVMsRUFDVCxNQUFjLEVBQ2QsZUFBZ0M7UUFFaEMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRU0sSUFBSSxDQUFDLEdBQTZCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQzFCLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1NBQzNDO2FBQU07WUFDTCxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDckM7SUFDSCxDQUFDO0lBRU0saUJBQWlCLENBQUMsR0FBZSxFQUFFLEtBQWE7UUFDckQsTUFBTSxTQUFTLEdBQUcsRUFBRSxHQUFHLEtBQUssQ0FB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QW1CLENBQUM7WUFDN0UsR0FBRyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLG1CQUFtQixDQUFDLG1CQUFtQixDQUFDO1lBQy9FLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNkO0lBQ0gsQ0FBQztJQUVNLG1CQUFtQixDQUFDLE1BQWM7UUFDdkMsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsSUFBSSxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEhhbmRsZSB9IGZyb20gJy4vaGFuZGxlJztcbmltcG9ydCB7IFBvaW50UG9vbCB9IGZyb20gJy4vcG9pbnRQb29sJztcbmltcG9ydCB7IFBvaW50IH0gZnJvbSAnLi9wb2ludCc7XG5pbXBvcnQgeyBDcm9wcGVyU2V0dGluZ3MgfSBmcm9tICcuLi9jcm9wcGVyLXNldHRpbmdzJztcbmltcG9ydCB7IEJvdW5kcyB9IGZyb20gJy4vYm91bmRzJztcblxuZXhwb3J0IGNsYXNzIERyYWdNYXJrZXIgZXh0ZW5kcyBIYW5kbGUge1xuICBwcml2YXRlIGljb25Qb2ludHM6IEFycmF5PFBvaW50PjtcbiAgcHJpdmF0ZSBzY2FsZWRJY29uUG9pbnRzOiBBcnJheTxQb2ludD47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgeDogbnVtYmVyLFxuICAgIHk6IG51bWJlcixcbiAgICByYWRpdXM6IG51bWJlcixcbiAgICBjcm9wcGVyU2V0dGluZ3M6IENyb3BwZXJTZXR0aW5nc1xuICApIHtcbiAgICBzdXBlcih4LCB5LCByYWRpdXMsIGNyb3BwZXJTZXR0aW5ncyk7XG4gICAgdGhpcy5pY29uUG9pbnRzID0gW107XG4gICAgdGhpcy5zY2FsZWRJY29uUG9pbnRzID0gW107XG4gICAgdGhpcy5nZXREcmFnSWNvblBvaW50cyh0aGlzLmljb25Qb2ludHMsIDEpO1xuICAgIHRoaXMuZ2V0RHJhZ0ljb25Qb2ludHModGhpcy5zY2FsZWRJY29uUG9pbnRzLCAxLjIpO1xuICB9XG5cbiAgcHVibGljIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcbiAgICBpZiAodGhpcy5vdmVyIHx8IHRoaXMuZHJhZykge1xuICAgICAgdGhpcy5kcmF3SWNvbihjdHgsIHRoaXMuc2NhbGVkSWNvblBvaW50cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZHJhd0ljb24oY3R4LCB0aGlzLmljb25Qb2ludHMpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXREcmFnSWNvblBvaW50cyhhcnI6IEFycmF5PGFueT4sIHNjYWxlOiBudW1iZXIpIHtcbiAgICBjb25zdCBtYXhMZW5ndGggPSAxNyAqIHNjYWxlO1xuICAgIGNvbnN0IGFycm93V2lkdGggPSAxNCAqIHNjYWxlO1xuICAgIGNvbnN0IGFycm93TGVuZ3RoID0gOCAqIHNjYWxlO1xuICAgIGNvbnN0IGNvbm5lY3RvclRocm9hdCA9IDQgKiBzY2FsZTtcblxuICAgIGFyci5wdXNoKFxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcbiAgICAgICAgLWNvbm5lY3RvclRocm9hdCAvIDIsXG4gICAgICAgIG1heExlbmd0aCAtIGFycm93TGVuZ3RoXG4gICAgICApXG4gICAgKTtcbiAgICBhcnIucHVzaChcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coLWFycm93V2lkdGggLyAyLCBtYXhMZW5ndGggLSBhcnJvd0xlbmd0aClcbiAgICApO1xuICAgIGFyci5wdXNoKG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coMCwgbWF4TGVuZ3RoKSk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGFycm93V2lkdGggLyAyLCBtYXhMZW5ndGggLSBhcnJvd0xlbmd0aClcbiAgICApO1xuICAgIGFyci5wdXNoKFxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcbiAgICAgICAgY29ubmVjdG9yVGhyb2F0IC8gMixcbiAgICAgICAgbWF4TGVuZ3RoIC0gYXJyb3dMZW5ndGhcbiAgICAgIClcbiAgICApO1xuICAgIGFyci5wdXNoKFxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhjb25uZWN0b3JUaHJvYXQgLyAyLCBjb25uZWN0b3JUaHJvYXQgLyAyKVxuICAgICk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxuICAgICAgICBtYXhMZW5ndGggLSBhcnJvd0xlbmd0aCxcbiAgICAgICAgY29ubmVjdG9yVGhyb2F0IC8gMlxuICAgICAgKVxuICAgICk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KG1heExlbmd0aCAtIGFycm93TGVuZ3RoLCBhcnJvd1dpZHRoIC8gMilcbiAgICApO1xuICAgIGFyci5wdXNoKG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3cobWF4TGVuZ3RoLCAwKSk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KG1heExlbmd0aCAtIGFycm93TGVuZ3RoLCAtYXJyb3dXaWR0aCAvIDIpXG4gICAgKTtcbiAgICBhcnIucHVzaChcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXG4gICAgICAgIG1heExlbmd0aCAtIGFycm93TGVuZ3RoLFxuICAgICAgICAtY29ubmVjdG9yVGhyb2F0IC8gMlxuICAgICAgKVxuICAgICk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KGNvbm5lY3RvclRocm9hdCAvIDIsIC1jb25uZWN0b3JUaHJvYXQgLyAyKVxuICAgICk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxuICAgICAgICBjb25uZWN0b3JUaHJvYXQgLyAyLFxuICAgICAgICAtbWF4TGVuZ3RoICsgYXJyb3dMZW5ndGhcbiAgICAgIClcbiAgICApO1xuICAgIGFyci5wdXNoKFxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhhcnJvd1dpZHRoIC8gMiwgLW1heExlbmd0aCArIGFycm93TGVuZ3RoKVxuICAgICk7XG4gICAgYXJyLnB1c2gobmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdygwLCAtbWF4TGVuZ3RoKSk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1hcnJvd1dpZHRoIC8gMiwgLW1heExlbmd0aCArIGFycm93TGVuZ3RoKVxuICAgICk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxuICAgICAgICAtY29ubmVjdG9yVGhyb2F0IC8gMixcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoXG4gICAgICApXG4gICAgKTtcbiAgICBhcnIucHVzaChcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coXG4gICAgICAgIC1jb25uZWN0b3JUaHJvYXQgLyAyLFxuICAgICAgICAtY29ubmVjdG9yVGhyb2F0IC8gMlxuICAgICAgKVxuICAgICk7XG4gICAgYXJyLnB1c2goXG4gICAgICBuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KFxuICAgICAgICAtbWF4TGVuZ3RoICsgYXJyb3dMZW5ndGgsXG4gICAgICAgIC1jb25uZWN0b3JUaHJvYXQgLyAyXG4gICAgICApXG4gICAgKTtcbiAgICBhcnIucHVzaChcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coLW1heExlbmd0aCArIGFycm93TGVuZ3RoLCAtYXJyb3dXaWR0aCAvIDIpXG4gICAgKTtcbiAgICBhcnIucHVzaChuZXcgUG9pbnRQb29sKCkuaW5zdGFuY2UuYm9ycm93KC1tYXhMZW5ndGgsIDApKTtcbiAgICBhcnIucHVzaChcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coLW1heExlbmd0aCArIGFycm93TGVuZ3RoLCBhcnJvd1dpZHRoIC8gMilcbiAgICApO1xuICAgIGFyci5wdXNoKFxuICAgICAgbmV3IFBvaW50UG9vbCgpLmluc3RhbmNlLmJvcnJvdyhcbiAgICAgICAgLW1heExlbmd0aCArIGFycm93TGVuZ3RoLFxuICAgICAgICBjb25uZWN0b3JUaHJvYXQgLyAyXG4gICAgICApXG4gICAgKTtcbiAgICBhcnIucHVzaChcbiAgICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5ib3Jyb3coLWNvbm5lY3RvclRocm9hdCAvIDIsIGNvbm5lY3RvclRocm9hdCAvIDIpXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBkcmF3SWNvbihjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgcG9pbnRzOiBBcnJheTxQb2ludD4pIHtcbiAgICBpZiAodGhpcy5jcm9wcGVyU2V0dGluZ3Muc2hvd0NlbnRlck1hcmtlcikge1xuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4Lm1vdmVUbyhwb2ludHNbMF0ueCArIHRoaXMucG9zaXRpb24ueCwgcG9pbnRzWzBdLnkgKyB0aGlzLnBvc2l0aW9uLnkpO1xuICAgICAgZm9yIChjb25zdCBwIG9mIHBvaW50cykge1xuICAgICAgICBjdHgubGluZVRvKHAueCArIHRoaXMucG9zaXRpb24ueCwgcC55ICsgdGhpcy5wb3NpdGlvbi55KTtcbiAgICAgIH1cbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLmRyYWdJY29uRmlsbENvbG9yO1xuICAgICAgY3R4LmZpbGwoKTtcbiAgICAgIGN0eC5saW5lV2lkdGggPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLmRyYWdJY29uU3Ryb2tlV2lkdGg7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLmRyYWdJY29uU3Ryb2tlQ29sb3I7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlY2FsY3VsYXRlUG9zaXRpb24oYm91bmRzOiBCb3VuZHMpIHtcbiAgICBjb25zdCBjID0gYm91bmRzLmdldENlbnRyZSgpO1xuICAgIHRoaXMuc2V0UG9zaXRpb24oYy54LCBjLnkpO1xuICAgIG5ldyBQb2ludFBvb2woKS5pbnN0YW5jZS5yZXR1cm5Qb2ludChjKTtcbiAgfVxufVxuIl19