import { Handle } from './handle';
export class CornerMarker extends Handle {
    constructor(x, y, radius, cropperSettings) {
        super(x, y, radius, cropperSettings);
    }
    drawCornerBorder(ctx) {
        let sideLength = 10;
        if (this.over || this.drag) {
            sideLength = 12;
        }
        let hDirection = this.cropperSettings.markerSizeMultiplier;
        let vDirection = this.cropperSettings.markerSizeMultiplier;
        if (this.horizontalNeighbour.position.x < this.position.x) {
            hDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.verticalNeighbour.position.y < this.position.y) {
            vDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        ctx.beginPath();
        if (this.cropperSettings.cropperDrawSettings.lineDash) {
            ctx.setLineDash([1, 3]);
        }
        ctx.lineJoin = 'miter';
        ctx.moveTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.closePath();
        ctx.lineWidth = this.cropperSettings.cropperDrawSettings.strokeWidth;
        ctx.strokeStyle =
            this.cropperSettings.cropperDrawSettings.strokeColor ||
                'rgba(255,255,255,.7)';
        ctx.stroke();
    }
    drawCornerFill(ctx) {
        let sideLength = 10;
        if (this.over || this.drag) {
            sideLength = 12;
        }
        let hDirection = this.cropperSettings.markerSizeMultiplier;
        let vDirection = this.cropperSettings.markerSizeMultiplier;
        if (this.horizontalNeighbour.position.x < this.position.x) {
            hDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.verticalNeighbour.position.y < this.position.y) {
            vDirection = -this.cropperSettings.markerSizeMultiplier;
        }
        if (this.cropperSettings.rounded) {
            const width = this.position.x - this.horizontalNeighbour.position.x;
            const height = this.position.y - this.verticalNeighbour.position.y;
            const offX = Math.round(Math.sin(Math.PI / 2) * Math.abs(width / 2)) / 4;
            const offY = Math.round(Math.sin(Math.PI / 2) * Math.abs(height / 2)) / 4;
            this.offset.x = hDirection > 0 ? offX : -offX;
            this.offset.y = vDirection > 0 ? offY : -offY;
        }
        else {
            this.offset.x = 0;
            this.offset.y = 0;
        }
        ctx.beginPath();
        if (this.cropperSettings.cropperDrawSettings.lineDash) {
            ctx.setLineDash([1, 3]);
        }
        ctx.moveTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y);
        ctx.lineTo(this.position.x + this.offset.x + sideLength * hDirection, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y + sideLength * vDirection);
        ctx.lineTo(this.position.x + this.offset.x, this.position.y + this.offset.y);
        ctx.closePath();
        ctx.fillStyle =
            this.cropperSettings.cropperDrawSettings.fillColor ||
                'rgba(255,255,255,.7)';
        ctx.fill();
    }
    moveX(x) {
        this.setPosition(x, this.position.y);
    }
    moveY(y) {
        this.setPosition(this.position.x, y);
    }
    move(x, y) {
        this.setPosition(x, y);
        this.verticalNeighbour.moveX(x);
        this.horizontalNeighbour.moveY(y);
    }
    addHorizontalNeighbour(neighbour) {
        this.horizontalNeighbour = neighbour;
    }
    addVerticalNeighbour(neighbour) {
        this.verticalNeighbour = neighbour;
    }
    getHorizontalNeighbour() {
        return this.horizontalNeighbour;
    }
    getVerticalNeighbour() {
        return this.verticalNeighbour;
    }
    draw(ctx) {
        this.drawCornerFill(ctx);
        this.drawCornerBorder(ctx);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29ybmVyTWFya2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWltZy1jcm9wcGVyL3NyYy9saWIvaW1hZ2UtY3JvcHBlci9tb2RlbC9jb3JuZXJNYXJrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBVyxNQUFNLFVBQVUsQ0FBQztBQVEzQyxNQUFNLE9BQU8sWUFBYSxTQUFRLE1BQU07SUFJdEMsWUFDRSxDQUFTLEVBQ1QsQ0FBUyxFQUNULE1BQWMsRUFDZCxlQUFnQztRQUVoQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVNLGdCQUFnQixDQUFDLEdBQTZCO1FBQ25ELElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUMxQixVQUFVLEdBQUcsRUFBRSxDQUFDO1NBQ2pCO1FBRUQsSUFBSSxVQUFVLEdBQVcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQztRQUNuRSxJQUFJLFVBQVUsR0FBVyxJQUFJLENBQUMsZUFBZSxDQUFDLG9CQUFvQixDQUFDO1FBQ25FLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUU7WUFDekQsVUFBVSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQztTQUN6RDtRQUNELElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUU7WUFDdkQsVUFBVSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQztTQUN6RDtRQUVELEdB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QyxHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIYW5kbGUsIElIYW5kbGUgfSBmcm9tICcuL2hhbmRsZSc7XG5pbXBvcnQgeyBDcm9wcGVyU2V0dGluZ3MgfSBmcm9tICcuLi9jcm9wcGVyLXNldHRpbmdzJztcblxuZXhwb3J0IGludGVyZmFjZSBJQ29ybmVyTWFya2VyIGV4dGVuZHMgSUhhbmRsZSB7XG4gIGhvcml6b250YWxOZWlnaGJvdXI6IENvcm5lck1hcmtlcjtcbiAgdmVydGljYWxOZWlnaGJvdXI6IENvcm5lck1hcmtlcjtcbn1cblxuZXhwb3J0IGNsYXNzIENvcm5lck1hcmtlciBleHRlbmRzIEhhbmRsZSBpbXBsZW1lbnRzIElDb3JuZXJNYXJrZXIge1xuICBwdWJsaWMgaG9yaXpvbnRhbE5laWdoYm91cjogQ29ybmVyTWFya2VyO1xuICBwdWJsaWMgdmVydGljYWxOZWlnaGJvdXI6IENvcm5lck1hcmtlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICB4OiBudW1iZXIsXG4gICAgeTogbnVtYmVyLFxuICAgIHJhZGl1czogbnVtYmVyLFxuICAgIGNyb3BwZXJTZXR0aW5nczogQ3JvcHBlclNldHRpbmdzXG4gICkge1xuICAgIHN1cGVyKHgsIHksIHJhZGl1cywgY3JvcHBlclNldHRpbmdzKTtcbiAgfVxuXG4gIHB1YmxpYyBkcmF3Q29ybmVyQm9yZGVyKGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTogdm9pZCB7XG4gICAgbGV0IHNpZGVMZW5ndGggPSAxMDtcbiAgICBpZiAodGhpcy5vdmVyIHx8IHRoaXMuZHJhZykge1xuICAgICAgc2lkZUxlbmd0aCA9IDEyO1xuICAgIH1cblxuICAgIGxldCBoRGlyZWN0aW9uOiBudW1iZXIgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcbiAgICBsZXQgdkRpcmVjdGlvbjogbnVtYmVyID0gdGhpcy5jcm9wcGVyU2V0dGluZ3MubWFya2VyU2l6ZU11bHRpcGxpZXI7XG4gICAgaWYgKHRoaXMuaG9yaXpvbnRhbE5laWdoYm91ci5wb3NpdGlvbi54IDwgdGhpcy5wb3NpdGlvbi54KSB7XG4gICAgICBoRGlyZWN0aW9uID0gLXRoaXMuY3JvcHBlclNldHRpbmdzLm1hcmtlclNpemVNdWx0aXBsaWVyO1xuICAgIH1cbiAgICBpZiAodGhpcy52ZXJ0aWNhbE5laWdoYm91ci5wb3NpdGlvbi55IDwgdGhpcy5wb3NpdGlvbi55KSB7XG4gICAgICB2RGlyZWN0aW9uID0gLXRoaXMuY3JvcHBlclNldHRpbmdzLm1hcmtlclNpemVNdWx0aXBsaWVyO1xuICAgIH1cblxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBpZiAodGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5saW5lRGFzaCkge1xuICAgICAgY3R4LnNldExpbmVEYXNoKFsxLCAzXSk7XG4gICAgfVxuICAgIGN0eC5saW5lSm9pbiA9ICdtaXRlcic7XG4gICAgY3R4Lm1vdmVUbyhcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55XG4gICAgKTtcbiAgICBjdHgubGluZVRvKFxuICAgICAgdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5vZmZzZXQueCArIHNpZGVMZW5ndGggKiBoRGlyZWN0aW9uLFxuICAgICAgdGhpcy5wb3NpdGlvbi55ICsgdGhpcy5vZmZzZXQueVxuICAgICk7XG4gICAgY3R4LmxpbmVUbyhcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LnggKyBzaWRlTGVuZ3RoICogaERpcmVjdGlvbixcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnkgKyBzaWRlTGVuZ3RoICogdkRpcmVjdGlvblxuICAgICk7XG4gICAgY3R4LmxpbmVUbyhcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LngsXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55ICsgc2lkZUxlbmd0aCAqIHZEaXJlY3Rpb25cbiAgICApO1xuICAgIGN0eC5saW5lVG8oXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxuICAgICAgdGhpcy5wb3NpdGlvbi55ICsgdGhpcy5vZmZzZXQueVxuICAgICk7XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIGN0eC5saW5lV2lkdGggPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLnN0cm9rZVdpZHRoO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9XG4gICAgICB0aGlzLmNyb3BwZXJTZXR0aW5ncy5jcm9wcGVyRHJhd1NldHRpbmdzLnN0cm9rZUNvbG9yIHx8XG4gICAgICAncmdiYSgyNTUsMjU1LDI1NSwuNyknO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfVxuXG4gIHB1YmxpYyBkcmF3Q29ybmVyRmlsbChjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6IHZvaWQge1xuICAgIGxldCBzaWRlTGVuZ3RoID0gMTA7XG4gICAgaWYgKHRoaXMub3ZlciB8fCB0aGlzLmRyYWcpIHtcbiAgICAgIHNpZGVMZW5ndGggPSAxMjtcbiAgICB9XG4gICAgbGV0IGhEaXJlY3Rpb246IG51bWJlciA9IHRoaXMuY3JvcHBlclNldHRpbmdzLm1hcmtlclNpemVNdWx0aXBsaWVyO1xuICAgIGxldCB2RGlyZWN0aW9uOiBudW1iZXIgPSB0aGlzLmNyb3BwZXJTZXR0aW5ncy5tYXJrZXJTaXplTXVsdGlwbGllcjtcbiAgICBpZiAodGhpcy5ob3Jpem9udGFsTmVpZ2hib3VyLnBvc2l0aW9uLnggPCB0aGlzLnBvc2l0aW9uLngpIHtcbiAgICAgIGhEaXJlY3Rpb24gPSAtdGhpcy5jcm9wcGVyU2V0dGluZ3MubWFya2VyU2l6ZU11bHRpcGxpZXI7XG4gICAgfVxuICAgIGlmICh0aGlzLnZlcnRpY2FsTmVpZ2hib3VyLnBvc2l0aW9uLnkgPCB0aGlzLnBvc2l0aW9uLnkpIHtcbiAgICAgIHZEaXJlY3Rpb24gPSAtdGhpcy5jcm9wcGVyU2V0dGluZ3MubWFya2VyU2l6ZU11bHRpcGxpZXI7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3JvcHBlclNldHRpbmdzLnJvdW5kZWQpIHtcbiAgICAgIGNvbnN0IHdpZHRoOiBudW1iZXIgPVxuICAgICAgICB0aGlzLnBvc2l0aW9uLnggLSB0aGlzLmhvcml6b250YWxOZWlnaGJvdXIucG9zaXRpb24ueDtcbiAgICAgIGNvbnN0IGhlaWdodDogbnVtYmVyID1cbiAgICAgICAgdGhpcy5wb3NpdGlvbi55IC0gdGhpcy52ZXJ0aWNhbE5laWdoYm91ci5wb3NpdGlvbi55O1xuXG4gICAgICBjb25zdCBvZmZYOiBudW1iZXIgPVxuICAgICAgICBNYXRoLnJvdW5kKE1hdGguc2luKE1hdGguUEkgLyAyKSAqIE1hdGguYWJzKHdpZHRoIC8gMikpIC8gNDtcbiAgICAgIGNvbnN0IG9mZlk6IG51bWJlciA9XG4gICAgICAgIE1hdGgucm91bmQoTWF0aC5zaW4oTWF0aC5QSSAvIDIpICogTWF0aC5hYnMoaGVpZ2h0IC8gMikpIC8gNDtcblxuICAgICAgdGhpcy5vZmZzZXQueCA9IGhEaXJlY3Rpb24gPiAwID8gb2ZmWCA6IC1vZmZYO1xuICAgICAgdGhpcy5vZmZzZXQueSA9IHZEaXJlY3Rpb24gPiAwID8gb2ZmWSA6IC1vZmZZO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9mZnNldC54ID0gMDtcbiAgICAgIHRoaXMub2Zmc2V0LnkgPSAwO1xuICAgIH1cblxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBpZiAodGhpcy5jcm9wcGVyU2V0dGluZ3MuY3JvcHBlckRyYXdTZXR0aW5ncy5saW5lRGFzaCkge1xuICAgICAgY3R4LnNldExpbmVEYXNoKFsxLCAzXSk7XG4gICAgfVxuICAgIGN0eC5tb3ZlVG8oXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxuICAgICAgdGhpcy5wb3NpdGlvbi55ICsgdGhpcy5vZmZzZXQueVxuICAgICk7XG4gICAgY3R4LmxpbmVUbyhcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMub2Zmc2V0LnggKyBzaWRlTGVuZ3RoICogaERpcmVjdGlvbixcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcbiAgICApO1xuICAgIGN0eC5saW5lVG8oXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54ICsgc2lkZUxlbmd0aCAqIGhEaXJlY3Rpb24sXG4gICAgICB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLm9mZnNldC55ICsgc2lkZUxlbmd0aCAqIHZEaXJlY3Rpb25cbiAgICApO1xuICAgIGN0eC5saW5lVG8oXG4gICAgICB0aGlzLnBvc2l0aW9uLnggKyB0aGlzLm9mZnNldC54LFxuICAgICAgdGhpcy5wb3NpdGlvbi55ICsgdGhpcy5vZmZzZXQueSArIHNpZGVMZW5ndGggKiB2RGlyZWN0aW9uXG4gICAgKTtcbiAgICBjdHgubGluZVRvKFxuICAgICAgdGhpcy5wb3NpdGlvbi54ICsgdGhpcy5vZmZzZXQueCxcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMub2Zmc2V0LnlcbiAgICApO1xuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICBjdHguZmlsbFN0eWxlID1cbiAgICAgIHRoaXMuY3JvcHBlclNldHRpbmdzLmNyb3BwZXJEcmF3U2V0dGluZ3MuZmlsbENvbG9yIHx8XG4gICAgICAncmdiYSgyNTUsMjU1LDI1NSwuNyknO1xuICAgIGN0eC5maWxsKCk7XG4gIH1cblxuICBwdWJsaWMgbW92ZVgoeDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5zZXRQb3NpdGlvbih4LCB0aGlzLnBvc2l0aW9uLnkpO1xuICB9XG5cbiAgcHVibGljIG1vdmVZKHk6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuc2V0UG9zaXRpb24odGhpcy5wb3NpdGlvbi54LCB5KTtcbiAgfVxuXG4gIHB1YmxpYyBtb3ZlKHg6IG51bWJlciwgeTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB0aGlzLnZlcnRpY2FsTmVpZ2hib3VyLm1vdmVYKHgpO1xuICAgIHRoaXMuaG9yaXpvbnRhbE5laWdoYm91ci5tb3ZlWSh5KTtcbiAgfVxuXG4gIHB1YmxpYyBhZGRIb3Jpem9udGFsTmVpZ2hib3VyKG5laWdoYm91cjogQ29ybmVyTWFya2VyKTogdm9pZCB7XG4gICAgdGhpcy5ob3Jpem9udGFsTmVpZ2hib3VyID0gbmVpZ2hib3VyO1xuICB9XG5cbiAgcHVibGljIGFkZFZlcnRpY2FsTmVpZ2hib3VyKG5laWdoYm91cjogQ29ybmVyTWFya2VyKTogdm9pZCB7XG4gICAgdGhpcy52ZXJ0aWNhbE5laWdoYm91ciA9IG5laWdoYm91cjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRIb3Jpem9udGFsTmVpZ2hib3VyKCk6IENvcm5lck1hcmtlciB7XG4gICAgcmV0dXJuIHRoaXMuaG9yaXpvbnRhbE5laWdoYm91cjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRWZXJ0aWNhbE5laWdoYm91cigpOiBDb3JuZXJNYXJrZXIge1xuICAgIHJldHVybiB0aGlzLnZlcnRpY2FsTmVpZ2hib3VyO1xuICB9XG5cbiAgcHVibGljIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpOiB2b2lkIHtcbiAgICB0aGlzLmRyYXdDb3JuZXJGaWxsKGN0eCk7XG4gICAgdGhpcy5kcmF3Q29ybmVyQm9yZGVyKGN0eCk7XG4gIH1cbn1cbiJdfQ==